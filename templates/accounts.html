{% extends 'base-pages.html' %}


{% block title %}Счета{% endblock %}
{% block lead_text %}
    Интерфейс для работы со счетами
{% endblock %}



{% block content %}

    <div class="d-flex controllers gap-3 mb-3 justify-content-center align-items-start">
        {#        <div class="d-flex flex-column">#}
        {#            <button class="btn btn-primary mb-3 unactive">Показать неактивные счета</button>#}
        {#            <button class="btn btn-primary mb-3 unactive d-none">Показать активные счета</button>#}
        {#            <button class="btn btn-primary mb-3 unactive">Показать все счета</button>#}
        {#        </div>#}
        {#        <div class="d-flex flex-column">#}
        {#            <button class="btn btn-primary mb-3 do-unactive">Деактивировать выбранные счета</button>#}
        {#            <button class="btn btn-primary mb-3 do-unactive">Активировать выбранные счета</button>#}
        {#        </div>#}
        {#        <button class="btn btn-primary mb-3 delete flex-start">Удалить выбранные счета</button>#}
        <button class="btn btn-success mb-3 transfer">Перевод</button>
        <button class="btn btn-primary mb-3 delete-transfers d-none">Удалить переводы</button>
        <button class="btn btn-danger mb-3 cancel-update d-none">Отменить редактирование</button>
    </div>
    <p class="text-center fs-4 mb-5 d-block">Всего денег: <b>{{ "{:.02f}".format(sum_accounts) }}</b></p>

    <div class="d-flex d-none transfer justify-content-center mb-5">
        <form method="post" class="d-none list-group border p-4 d-inline-block">
            <h2 class="mb-4 text-center">Перевод</h2>

            <div class="d-flex gap-3 mb-4">
                <div>
                    <label for="account_from">Откуда:</label>
                    <select required name="account_from" id="account_from" class="mt-3 form-control form-select">
                        {% for account in accounts %}
                            <option value="{{ account.Account.name|capitalize }}">{{ account.Account.name|capitalize }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label for="account_to">Куда:</label>
                    <select required name="account_to" id="account_to" class="mt-3 form-control form-select">
                        {% for account in accounts %}
                            <option value="{{ account.Account.name|capitalize }}">{{ account.Account.name|capitalize }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <b><label class="mb-2" for="amount">Сумма</label></b>
            <input autocomplete="off" type="text" name="amount" id="amount" class="form-control"><br>

            <b><label class="mb-2" for="notice">Примечание</label></b>
            <input autocomplete="off" type="text" name="notice" id="notice" class="form-control"><br>

            <input type="submit" class="btn btn-success" value="Перевести">
        </form>
        <table class="table table-striped">
            <thead>
            <tr>
                <th style="width: 20px"><input class="form-check-input border-dark" style="width: 16px; height: 16px"
                                               type="checkbox"></th>
                <th>№</th>
                <th>Дата</th>
                <th>Откуда</th>
                <th>Куда</th>
                <th>Сумма</th>
                <th>Примечание</th>
                <th></th>
            </tr>
            </thead>
            <tbody>
            <tr class="align-middle create">
                <form method="post">
                    <td></td>
                    <td></td>
                    <td class="ps-0"><input type="date" name="date" id="date" class="form-control"
                                            value="{{ today.isoformat() }}"></td>
                    <td class="ps-0">
                        <select required name="account_from" id="account_from" class="form-control form-select">
                            {% for account in accounts %}
                                <option value="{{ account.Account.name|capitalize }}">{{ account.Account.name|capitalize }}</option>
                            {% endfor %}
                        </select>
                    </td>
                    <td class="ps-0">
                        <select required name="account_to" id="account_to" class=" form-control form-select">
                            {% for account in accounts %}
                                <option value="{{ account.Account.name|capitalize }}">{{ account.Account.name|capitalize }}</option>
                            {% endfor %}
                        </select>
                    </td>
                    <td class="ps-0"><input autocomplete="off" type="text" name="amount" id="amount"
                                            class="form-control amount"></td>
                    <td class="ps-0 w-25"><input autocomplete="off" type="text" id="notice" name="notice" class="form-control"></td>
                    <td>
                        <input class="btn create btn-primary" type="submit" value="+">
                        {#                    <button class="btn btn-primary create"><b>+</b></button>#}
                    </td>
                </form>
            </tr>
            <tr class="align-middle update d-none">
                <td></td>
                <td class="id"></td>
                <td class="ps-0"><input type="date" name="date" id="date" class="date form-control"
                                        value="{{ today.isoformat() }}"></td>
                <td class="ps-0">
                    <select required name="account_from" id="account_from" class="form-control form-select">
                        {% for account in accounts %}
                            <option value="{{ account.Account.name|capitalize }}">{{ account.Account.name|capitalize }}</option>
                        {% endfor %}
                    </select>
                </td>
                <td class="ps-0">
                    <select required name="account_to" id="account_to" class="form-control form-select">
                        {% for account in accounts %}
                            <option value="{{ account.Account.name|capitalize }}">{{ account.Account.name|capitalize }}</option>
                        {% endfor %}
                    </select>
                </td>
                <td class="ps-0">
                    <input autocomplete="off" type="text" name="amount" id="amount" class="amount form-control">
                </td>
                <td class="ps-0 w-25">
                    <input autocomplete="off" type="text" id="notice" name="notice" class="notice form-control">
                </td>
                <td class="">
                    <button class="btnupdate btn-success"><b>✓</b></button>
                </td>
            </tr>

            {% for transfer in transfers %}
                <tr class="align-middle">
                    <td class="checkbox"><input class="form-check-input border-dark" data-id="{{ transfer.id }}"
                                                style="width: 16px; height: 16px;"
                                                type="checkbox"></td>
                    <td><b>{{ transfer.id }}</b></td>
                    <td>{{ transfer.date.strftime('%d %B %Y') }}</td>
                    <td class="border-start">
                        <div class="d-flex justify-content-between">
                            <span>{{ transfer.account_from|capitalize }}</span>
                            <span class="" style="color: red">-{{ "{:.02f}".format(transfer.amount) }}</span>
                        </div>
                    </td>
                    <td class="border-start border-end">
                        <div class="d-flex justify-content-between ">
                            <span>{{ transfer.account_to|capitalize }}</span>
                            <span class="" style="color: green">+{{ "{:.02f}".format(transfer.amount) }}</span>
                        </div>
                    </td>
                    {#                    <td>{{ "{:.02f}".format(transfer.amount) }}</td>#}
                    <td colspan="2"><span class="ms-3">{{ transfer.notice }}</span></td>
                <td></td>
                </tr>
                </tbody>
            {% endfor %}

        </table>
    </div>


    <div class="d-flex flex-wrap justify-content-center mb-5 mt-5" style="gap: 80px !important;">
        <div style="min-width: 400px !important;">
            <table class="table table-striped">
                <thead>
                <tr>
                    {#                    <th style="width: 20px"><input style="width: 16px; height: 16px;" type="checkbox"></th>#}
                    <th>№</th>
                    <th>Счёт</th>
                    <th class="">Баланс</th>
                    <th></th>
                </tr>
                </thead>
                <tbody>
                {% for el in accounts %}
                    <tr class="align-middle">
                        {#                        <td class="checkbox"><input data-id="{{ el.id }}" style="width: 16px; height: 16px;"#}
                        {#                                                    type="checkbox"></td>#}
                        <td class="id"><b>{{ el.Account.id }}</b></td>
                        <td class="name">{{ el.Account.name|capitalize }}</td>
                        <td class="balance">{{ "{:.02f}".format(el.Account.balance) }}</td>
                        <td class="p-0" style="width: 35px">
                            <button class="update btn p-0">
                                <img style="width: 30px; height: 30px;"
                                     src="{{ url_for('static', filename='svges/edit.svg') }}" alt>
                            </button>
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>

        <form method="post" class="create list-group border p-4">
            <h2 class="mb-4 text-center">Добавление счёта</h2>

            <b><label class="mb-2" for="name">Название</label></b>
            <input autocomplete="off" type="text" name="name" id="name" class="form-control"><br>

            <b><label class="mb-2" for="balance">Начальный баланс</label></b>
            <input autocomplete="off" type="text" name="balance" id="balance" class="form-control"><br>

            <input type="submit" class="btn btn-success" value="Добавить">
        </form>

        <form method="post" class="list-group border p-4 d-none update">
            <h2 class="mb-4 text-center">Редактирование счёта</h2>

            <b><label class="d-none" for="id">ID</label></b>
            <input class="id d-none" type="text" id="id" name="id"><br>

            <b><label class="mb-2" for="name">Название</label></b>
            <input autocomplete="off" type="text" name="name" id="name" class="form-control name"><br>

            <b><label class="mb-2" for="balance">Баланс</label></b>
            <input autocomplete="off" type="text" name="balance" id="balance" class="form-control balance"><br>

            <input type="submit" class="btn btn-success" value="Обновить">
        </form>
    </div>
    <script src="{{ url_for('static', filename='scripts/accounts.js') }}"></script>
{% endblock %}